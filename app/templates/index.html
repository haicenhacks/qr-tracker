{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Index{% endblock %}</h1>
{% endblock %}
{% block content %}



<div>
  {% if not current_user.is_authenticated %}
  <p>If you have reached this page, you have found the index. This is part of an information security experiment. You have probably scanned a QR code that didn't work.

  This is in no way malicious. None of your personal data has been collected, beyond what is sent to any website. The extent of information collected is shown below:
  </p>
  {% endif %}
  {% if user_ip %}
    <p>Your client: {{ user_ip }} - {{ user_agent }}</p>
  {% else %}


    <h2>{{ this_qr.name }}</h2>
    QR code: <img src="{{ qrcode(this_qr.qr_data, error_correction='H')}}">

    {# QR data: {{this_qr.uuid}} #}
    <br>
    {% if current_user.is_authenticated %}
      <a href="{{ url_for('delete_uuid', id=this_qr.uuid)}}">Delete</a>
      <br>
      <a href="{{ url_for('edit_uuid', id=this_qr.uuid)}}">Edit</a>
    {% endif %}
    {% endif %}


    {% if visitors %}
     <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>Time</th>
          <th>IP address</th>
          <th>User Agent</th>
        </tr>
      </thead>
      <tbody>
      {% for visitor in visitors %}
        <tr>
          <td>{{ visitor.time }}</td>
          <td>{{ visitor.ip_address }}</td>
          <td>{{ visitor.user_agent }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
    {% endif %}
</div>

{% endblock %}
